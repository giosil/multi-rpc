<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>WDemo - Frontend ver. 1.0.0</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th {
      background-color: #eeeeee;
    }
  </style>
</head>
<body>
  <h1>WDemo - Frontend ver. 1.0.0</h1>
  <hr>
  <h4>Configuration:</h4>
  <form id="formConfig" name="formConfig" action="javascript:void(0);">
     <label for="rpcURL">URL:</label> &nbsp;&nbsp;<input type="text" id="rpcURL" name="rpcURL" value="/wdemo-be/rpc" size="100"><br><br>
     <label for="rpcKey">Key:</label> &nbsp;&nbsp;<textarea id="rpcKey" name="rpcToken" rows="4" cols="100"></textarea>
  </form>
  <p><strong>Direct</strong>: /wdemo-be/rpc<br>
  <strong>Direct</strong>: http://wdemo.dew.org/wdemo-be/rpc<br>
  <strong>WSO2 APIM</strong>: http://localhost:8280/wdemo-be/1.0.0/rpc<br>
  <strong>WSO2 APIM</strong>: http://gwapi.dew.org/wdemo-be/1.0.0/rpc<br>
  </p>
  <hr>
  <h4>Application:</h4>
  <form id="formContact" name="formContact" action="javascript:void(0);">
     <label for="contactName">Name:</label> <input type="text" id="contactName" name="contactName">
      | <button it="btnAdd" type="button" onclick="onBtnAddClick()">Add</button>
      | <button it="btnClear" type="button" onclick="onBtnClearClick()">Clear</button>
  </form>
  <hr>
  <table id="tableContacts" style="width: 30%">
    <caption>Contacts</caption>
    <thead id="theadContacts">
      <tr>
        <th>Name</th>
      </tr>
    </thead>
    <tbody id="tbodyContacts">
    </tbody>
  </table>
  
  <script type="text/javascript" src="js/jrpc.js"></script>
  
  <script language="javascript">
    window.onload = function(e) {
      console.log('onload');
      list();
    };

    function onBtnAddClick() {
      console.log('onBtnAddClick');
      var txtName = document.getElementById('contactName');
      if(!txtName) return;
      var n = txtName.value;
      if(!n) {
        alert('Missing name!');
        txtName.focus();
        return;
      }
      txtName.value = '';
      txtName.focus();
      var jrpc = getJrpc();
      jrpc.execute('CONTACTS.add', [{"name": n}], function(result) {
        if(result) {
          list();
        }
        else {
          alert('Operation failed');
        }
      });
    }

    function onBtnClearClick() {
      console.log('onBtnClearClick');
      let tbody = document.getElementById('tbodyContacts');
      if(!tbody) return;
      var txtName = document.getElementById('contactName');
      if(txtName) {
        txtName.value = '';
        txtName.focus();
      }
      var jrpc = getJrpc();
      jrpc.execute('CONTACTS.clear', [], function(result) {
        if(result) {
          tbody.innerHTML = '';
        }
        else {
          alert('Operation failed');
        }
      });
    }

    function list() {
      console.log('list');
      var jrpc = getJrpc();
      jrpc.execute('CONTACTS.list', [], function(result) {
        if(!result || !result.length) return;
        var tb = '';
        for(var contact of result) {
          tb += '<tr><td>' + contact.name + '</td></tr>';
        }
        let tbody = document.getElementById('tbodyContacts');
        if(!tbody) return;
        tbody.innerHTML = tb;
      });
    }

    function getJrpc() {
      var jrpc = new JRPC("/wdemo-be/rpc");
      var txtRpcURL = document.getElementById('rpcURL');
      if(txtRpcURL) {
        var rpcURL = txtRpcURL.value;
        if(rpcURL) {
          jrpc.setURL(rpcURL);
        }
      }
      var txtRpcKey = document.getElementById('rpcKey');
      if(txtRpcKey) {
        var rpcKey = txtRpcKey.value;
        if(rpcKey) {
          jrpc.setInternalKey(rpcKey);
        }
        else {
          jrpc.setInternalKey("");
        }
      }
      return jrpc;
    }
  </script>
</body>
</html>